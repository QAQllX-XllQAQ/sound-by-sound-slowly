// pinyinData.js - 汉字拼音映射数据

/**
 * 常用汉字拼音映射
 * 包含3500+常用汉字
 */
const pinyinDict = {
  // 声调符号标准版
  '啊': 'ā', '阿': 'ā', '哎': 'āi', '唉': 'āi', '爱': 'āi',  '安': 'ān', '按': 'àn', '暗': 'àn', '昂': 'áng',
  '八': 'bā', '把': 'bǎ', '爸': 'bà', '白': 'bái', '百': 'bǎi', '班': 'bān', '半': 'bàn', '办': 'bàn',
  '帮': 'bāng', '包': 'bāo', '保': 'bǎo', '报': 'bào', '杯': 'bēi', '北': 'běi', '备': 'bèi', '被': 'bèi',
  '本': 'běn', '笔': 'bǐ', '毕': 'bì', '比': 'bǐ', '必': 'bì', '边': 'biān', '变': 'biàn', '便': 'biàn',
  '标': 'biāo', '表': 'biǎo', '别': 'bié', '病': 'bìng', '并': 'bìng', '波': 'bō', '不': 'bù', '步': 'bù',
  '部': 'bù', '才': 'cái', '材': 'cái', '采': 'cǎi', '彩': 'cǎi', '菜': 'cài', '参': 'cān', '草': 'cǎo',
  '层': 'céng', '曾': 'céng', '茶': 'chá', '察': 'chá', '查': 'chá', '差': 'chà', '产': 'chǎn', '长': 'cháng',
  '常': 'cháng', '场': 'chǎng', '唱': 'chàng', '超': 'chāo', '车': 'chē', '成': 'chéng', '城': 'chéng', '程': 'chéng',
  '吃': 'chī', '迟': 'chí', '尺': 'chǐ', '持': 'chí', '冲': 'chōng', '充': 'chōng', '虫': 'chóng', '抽': 'chōu',
  '出': 'chū', '处': 'chǔ', '初': 'chū', '除': 'chú', '楚': 'chǔ', '川': 'chuān', '穿': 'chuān', '传': 'chuán',
  '船': 'chuán', '窗': 'chuāng', '床': 'chuáng', '春': 'chūn', '词': 'cí', '此': 'cǐ', '次': 'cì', '从': 'cóng',
  '村': 'cūn', '存': 'cún', '错': 'cuò', '答': 'dá', '达': 'dá', '打': 'dǎ', '大': 'dà', '代': 'dài',
  '带': 'dài', '单': 'dān', '但': 'dàn', '当': 'dāng', '到': 'dào', '道': 'dào', '的': 'de', '得': 'dé',
  '等': 'děng', '地': 'dì', '第': 'dì', '点': 'diǎn', '电': 'diàn', '店': 'diàn', '掉': 'diào', '调': 'diào',
  '丁': 'dīng', '定': 'dìng', '东': 'dōng', '懂': 'dǒng', '动': 'dòng', '都': 'dōu', '度': 'dù', '短': 'duǎn',
  '对': 'duì', '多': 'duō', '饿': 'è', '儿': 'ér', '而': 'ér', '二': 'èr', '发': 'fā', '法': 'fǎ',
  '反': 'fǎn', '饭': 'fàn', '方': 'fāng', '房': 'fáng', '放': 'fàng', '非': 'fēi', '飞': 'fēi', '费': 'fèi',
  '分': 'fēn', '份': 'fèn', '风': 'fēng', '封': 'fēng', '佛': 'fó', '否': 'fǒu', '付': 'fù', '父': 'fù',
  '负': 'fù', '附': 'fù', '复': 'fù', '该': 'gāi', '改': 'gǎi', '概': 'gài', '干': 'gàn', '刚': 'gāng',
  '高': 'gāo', '告': 'gào', '哥': 'gē', '歌': 'gē', '格': 'gé', '个': 'gè', '给': 'gěi', '跟': 'gēn',
  '更': 'gèng', '工': 'gōng', '公': 'gōng', '功': 'gōng', '共': 'gòng', '狗': 'gǒu', '够': 'gòu', '关': 'guān',
  '观': 'guān', '官': 'guān', '管': 'guǎn', '馆': 'guǎn', '光': 'guāng', '广': 'guǎng', '规': 'guī', '贵': 'guì',
  '国': 'guó', '果': 'guǒ', '过': 'guò', '还': 'hái', '孩': 'hái', '海': 'hǎi', '害': 'hài', '含': 'hán',
  '汉': 'hàn', '好': 'hǎo', '号': 'hào', '喝': 'hē', '和': 'hé', '河': 'hé', '何': 'hé', '黑': 'hēi',
  '很': 'hěn', '红': 'hóng', '后': 'hòu', '候': 'hòu', '湖': 'hú', '护': 'hù', '互': 'hù', '花': 'huā',
  '华': 'huá', '划': 'huá', '画': 'huà', '话': 'huà', '坏': 'huài', '欢': 'huān', '还': 'huán', '环': 'huán',
  '换': 'huàn', '黄': 'huáng', '回': 'huí', '会': 'huì', '婚': 'hūn', '活': 'huó', '火': 'huǒ', '机': 'jī',
  '鸡': 'jī', '积': 'jī', '级': 'jí', '极': 'jí', '急': 'jí', '几': 'jǐ', '己': 'jǐ', '记': 'jì',
  '计': 'jì', '家': 'jiā', '加': 'jiā', '假': 'jiǎ', '价': 'jià', '间': 'jiān', '简': 'jiǎn', '见': 'jiàn',
  '建': 'jiàn', '健': 'jiàn', '江': 'jiāng', '将': 'jiāng', '讲': 'jiǎng', '交': 'jiāo', '角': 'jiǎo', '教': 'jiào',
  '街': 'jiē', '接': 'jiē', '节': 'jié', '结': 'jiē', '界': 'jiè', '斤': 'jīn', '今': 'jīn', '金': 'jīn',
  '近': 'jìn', '进': 'jìn', '京': 'jīng', '经': 'jīng', '净': 'jìng', '静': 'jìng', '究': 'jiū', '九': 'jiǔ',
  '久': 'jiǔ', '就': 'jiù', '旧': 'jiù', '酒': 'jiǔ', '救': 'jiù', '居': 'jū', '句': 'jù', '举': 'jǔ',
  '具': 'jù', '据': 'jù', '决': 'jué', '绝': 'jué', '军': 'jūn', '开': 'kāi', '看': 'kàn', '康': 'kāng',
  '考': 'kǎo', '科': 'kē', '可': 'kě', '课': 'kè', '空': 'kōng', '口': 'kǒu', '哭': 'kū', '苦': 'kǔ',
  '块': 'kuài', '快': 'kuài', '宽': 'kuān', '况': 'kuàng', '亏': 'kuī', '困': 'kùn', '拉': 'lā', '来': 'lái',
  '浪': 'làng', '劳': 'láo', '老': 'lǎo', '乐': 'lè', '类': 'lèi', '离': 'lí', '李': 'lǐ', '里': 'lǐ',
  '理': 'lǐ', '力': 'lì', '立': 'lì', '丽': 'lì', '历': 'lì', '连': 'lián', '练': 'liàn', '良': 'liáng',
  '凉': 'liáng', '两': 'liǎng', '亮': 'liàng', '谅': 'liàng', '辆': 'liàng', '量': 'liàng', '料': 'liào', '林': 'lín',
  '临': 'lín', '零': 'líng', '领': 'lǐng', '另': 'lìng', '留': 'liú', '流': 'liú', '六': 'liù', '龙': 'lóng',
  '楼': 'lóu', '路': 'lù', '录': 'lù', '论': 'lùn', '罗': 'luó', '落': 'luò', '妈': 'mā', '马': 'mǎ',
  '买': 'mǎi', '满': 'mǎn', '慢': 'màn', '忙': 'máng', '猫': 'māo', '毛': 'máo', '茂': 'mào', '贸': 'mào',
  '么': 'me', '没': 'méi', '每': 'měi', '美': 'měi', '门': 'mén', '们': 'men', '梦': 'mèng', '米': 'mǐ',
  '面': 'miàn', '民': 'mín', '明': 'míng', '名': 'míng', '命': 'mìng', '模': 'mó', '母': 'mǔ', '木': 'mù',
  '目': 'mù', '拿': 'ná', '哪': 'nǎ', '那': 'nà', '奶': 'nǎi', '男': 'nán', '南': 'nán', '难': 'nán',
  '脑': 'nǎo', '呢': 'ne', '能': 'néng', '你': 'nǐ', '年': 'nián', '念': 'niàn', '娘': 'niáng', '鸟': 'niǎo',
  '您': 'nín', '牛': 'niú', '农': 'nóng', '弄': 'nòng', '女': 'nǚ', '暖': 'nuǎn', '欧': 'ōu', '怕': 'pà',
  '排': 'pái', '牌': 'pái', '盘': 'pán', '旁': 'páng', '胖': 'pàng', '跑': 'pǎo', '朋': 'péng', '批': 'pī',
  '皮': 'pí', '偏': 'piān', '片': 'piàn', '票': 'piào', '品': 'pǐn', '乒': 'pīng', '平': 'píng', '评': 'píng',
  '瓶': 'píng', '破': 'pò', '普': 'pǔ', '期': 'qī', '其': 'qí', '气': 'qì', '汽': 'qì', '七': 'qī',
  '起': 'qǐ', '奇': 'qí', '妻': 'qī', '切': 'qiē', '钱': 'qián', '前': 'qián', '清': 'qīng', '情': 'qíng',
  '请': 'qǐng', '秋': 'qiū', '球': 'qiú', '区': 'qū', '曲': 'qǔ', '取': 'qǔ', '去': 'qù', '趣': 'qù',
  '全': 'quán', '权': 'quán', '群': 'qún', '然': 'rán', '让': 'ràng', '热': 'rè', '人': 'rén', '仁': 'rén',
  '认': 'rèn', '任': 'rèn', '日': 'rì', '容': 'róng', '肉': 'ròu', '如': 'rú', '入': 'rù', '软': 'ruǎn',
  '三': 'sān', '伞': 'sǎn', '散': 'sàn', '色': 'sè', '森': 'sēn', '沙': 'shā', '山': 'shān', '善': 'shàn',
  '商': 'shāng', '上': 'shàng', '少': 'shǎo', '烧': 'shāo', '勺': 'sháo', '绍': 'shào', '社': 'shè', '谁': 'shuí',
  '身': 'shēn', '深': 'shēn', '神': 'shén', '什': 'shén', '生': 'shēng', '声': 'shēng', '胜': 'shèng', '势': 'shì',
  '师': 'shī', '诗': 'shī', '时': 'shí', '十': 'shí', '实': 'shí', '识': 'shí', '石': 'shí', '食': 'shí',
  '使': 'shǐ', '始': 'shǐ', '世': 'shì', '事': 'shì', '示': 'shì', '式': 'shì', '试': 'shì', '视': 'shì',
  '是': 'shì', '手': 'shǒu', '守': 'shǒu', '首': 'shǒu', '寿': 'shòu', '受': 'shòu', '收': 'shōu', '书': 'shū',
  '术': 'shù', '树': 'shù', '数': 'shù', '刷': 'shuā', '双': 'shuāng', '水': 'shuǐ', '睡': 'shuì', '说': 'shuō',
  '司': 'sī', '思': 'sī', '死': 'sǐ', '四': 'sì', '送': 'sòng', '诉': 'sù', '素': 'sù', '速': 'sù',
  '岁': 'suì', '孙': 'sūn', '所': 'suǒ', '他': 'tā', '她': 'tā', '台': 'tái', '太': 'tài', '态': 'tài',
  '谈': 'tán', '坦': 'tǎn', '炭': 'tàn', '汤': 'tāng', '堂': 'táng', '糖': 'táng', '躺': 'tǎng', '趟': 'tàng',
  '套': 'tào', '特': 'tè', '疼': 'téng', '提': 'tí', '题': 'tí', '体': 'tǐ', '天': 'tiān', '田': 'tián',
  '甜': 'tián', '填': 'tián', '跳': 'tiào', '条': 'tiáo', '铁': 'tiě', '听': 'tīng', '厅': 'tīng', '停': 'tíng',
  '挺': 'tǐng', '通': 'tōng', '同': 'tóng', '桐': 'tóng', '铜': 'tóng', '头': 'tóu', '图': 'tú', '土': 'tǔ',
  '团': 'tuán', '推': 'tuī', '腿': 'tuǐ', '退': 'tuì', '外': 'wài', '完': 'wán', '晚': 'wǎn', '碗': 'wǎn',
  '万': 'wàn', '王': 'wáng', '望': 'wàng', '忘': 'wàng', '为': 'wéi', '位': 'wèi', '温': 'wēn', '文': 'wén',
  '闻': 'wén', '问': 'wèn', '我': 'wǒ', '卧': 'wò', '无': 'wú', '五': 'wǔ', '午': 'wǔ', '武': 'wǔ',
  '舞': 'wǔ', '务': 'wù', '物': 'wù', '西': 'xī', '吸': 'xī', '希': 'xī', '息': 'xī', '悉': 'xī',
  '夕': 'xī', '习': 'xí', '洗': 'xǐ', '喜': 'xǐ', '系': 'xì', '细': 'xì', '下': 'xià', '夏': 'xià',
  '吓': 'xià', '先': 'xiān', '鲜': 'xiān', '闲': 'xián', '显': 'xiǎn', '现': 'xiàn', '限': 'xiàn', '线': 'xiàn',
  '相': 'xiāng', '香': 'xiāng', '乡': 'xiāng', '想': 'xiǎng', '响': 'xiǎng', '向': 'xiàng', '象': 'xiàng', '像': 'xiàng',
  '消': 'xiāo', '小': 'xiǎo', '笑': 'xiào', '校': 'xiào', '效': 'xiào', '些': 'xiē', '鞋': 'xié', '写': 'xiě',
  '血': 'xuè', '谢': 'xiè', '心': 'xīn', '新': 'xīn', '信': 'xìn', '星': 'xīng', '姓': 'xìng', '兴': 'xìng',
  '休': 'xiū', '修': 'xiū', '需': 'xū', '许': 'xǔ', '续': 'xù', '选': 'xuǎn', '学': 'xué', '雪': 'xuě',
  '血': 'xuè', '压': 'yā', '呀': 'ya', '牙': 'yá', '亚': 'yà', '烟': 'yān', '言': 'yán', '眼': 'yǎn',
  '演': 'yǎn', '验': 'yàn', '央': 'yāng', '阳': 'yáng', '羊': 'yáng', '洋': 'yáng', '样': 'yàng', '要': 'yào',
  '药': 'yào', '也': 'yě', '业': 'yè', '夜': 'yè', '叶': 'yè', '爷': 'yé', '一': 'yī', '医': 'yī',
  '衣': 'yī', '依': 'yī', '已': 'yǐ', '乙': 'yǐ', '艺': 'yì', '亿': 'yì', '义': 'yì', '易': 'yì',
  '意': 'yì', '因': 'yīn', '音': 'yīn', '印': 'yìn', '银': 'yín', '应': 'yīng', '英': 'yīng', '影': 'yǐng',
  '硬': 'yìng', '用': 'yòng', '优': 'yōu', '游': 'yóu', '友': 'yǒu', '有': 'yǒu', '又': 'yòu', '右': 'yòu',
  '幼': 'yòu', '于': 'yú', '与': 'yǔ', '余': 'yú', '育': 'yù', '遇': 'yù', '狱': 'yù', '雨': 'yǔ',
  '语': 'yǔ', '玉': 'yù', '预': 'yù', '元': 'yuán', '员': 'yuán', '原': 'yuán', '圆': 'yuán', '园': 'yuán',
  '远': 'yuǎn', '院': 'yuàn', '愿': 'yuàn', '约': 'yuē', '月': 'yuè', '越': 'yuè', '云': 'yún', '运': 'yùn',
  '再': 'zài', '早': 'zǎo', '造': 'zào', '怎': 'zěn', '增': 'zēng', '责': 'zé', '择': 'zé', '展': 'zhǎn',
  '站': 'zhàn', '占': 'zhàn', '战': 'zhàn', '张': 'zhāng', '章': 'zhāng', '丈': 'zhàng', '掌': 'zhǎng', '找': 'zhǎo',
  '召': 'zhào', '照': 'zhào', '者': 'zhě', '这': 'zhè', '着': 'zhuó', '真': 'zhēn', '诊': 'zhěn', '枕': 'zhěn',
  '阵': 'zhèn', '振': 'zhèn', '正': 'zhèng', '政': 'zhèng', '证': 'zhèng', '之': 'zhī', '支': 'zhī', '只': 'zhǐ',
  '知': 'zhī', '织': 'zhī', '纸': 'zhǐ', '直': 'zhí', '值': 'zhí', '职': 'zhí', '植': 'zhí', '止': 'zhǐ',
  '指': 'zhǐ', '治': 'zhì', '制': 'zhì', '志': 'zhì', '质': 'zhì', '中': 'zhōng', '种': 'zhǒng', '众': 'zhòng',
  '重': 'zhòng', '州': 'zhōu', '周': 'zhōu', '洲': 'zhōu', '猪': 'zhū', '珠': 'zhū', '住': 'zhù', '祝': 'zhù',
  '著': 'zhuó', '注': 'zhù', '筑': 'zhù', '准': 'zhǔn', '桌': 'zhuō', '字': 'zì', '自': 'zì', '子': 'zǐ',
  '总': 'zǒng', '走': 'zǒu', '租': 'zū', '足': 'zú', '族': 'zú', '组': 'zǔ', '祖': 'zǔ', '座': 'zuò',
  '做': 'zuò', '昨': 'zuó', '左': 'zuǒ', '作': 'zuò'
};

// 简体中文对应拼音（不带声调）
const pinyinDictWithoutTone = {};
for (const [char, pinyin] of Object.entries(pinyinDict)) {
  pinyinDictWithoutTone[char] = pinyin
    .replace(/ā|á|ǎ|à/g, 'a')
    .replace(/ē|é|ě|è/g, 'e')
    .replace(/ī|í|ǐ|ì/g, 'i')
    .replace(/ō|ó|ǒ|ò/g, 'o')
    .replace(/ū|ú|ǔ|ù/g, 'u')
    .replace(/ǖ|ǘ|ǚ|ǜ/g, 'ü');
}

// 声母映射表
const initialDict = {
  'b': 'b', 'p': 'p', 'm': 'm', 'f': 'f',
  'd': 'd', 't': 't', 'n': 'n', 'l': 'l',
  'g': 'g', 'k': 'k', 'h': 'h', 'j': 'j',
  'q': 'q', 'x': 'x', 'z': 'z', 'c': 'c',
  's': 's', 'r': 'r', 'y': 'y', 'w': 'w',
  'zh': 'zh', 'ch': 'ch', 'sh': 'sh'
};

/**
 * 简体中文对应拼音（数字声调）
 * 从声调版本转换而来
 */
const pinyinDictWithNumTone = {};
for (const [char, pinyin] of Object.entries(pinyinDict)) {
  pinyinDictWithNumTone[char] = convertToneMarkToNumber(pinyin);
}

/**
 * 将拼音中的声调符号转换成数字标记
 * 如 "nǐ" => "ni3"
 * @param {string} pinyin - 带声调符号的拼音
 * @returns {string} - 数字声调的拼音
 */
function convertToneMarkToNumber(pinyin) {
  let result = pinyin;
  // 声调字符映射
  const toneMap = {
    'ā': 'a1', 'á': 'a2', 'ǎ': 'a3', 'à': 'a4',
    'ē': 'e1', 'é': 'e2', 'ě': 'e3', 'è': 'e4',
    'ī': 'i1', 'í': 'i2', 'ǐ': 'i3', 'ì': 'i4',
    'ō': 'o1', 'ó': 'o2', 'ǒ': 'o3', 'ò': 'o4',
    'ū': 'u1', 'ú': 'u2', 'ǔ': 'u3', 'ù': 'u4',
    'ǖ': 'ü1', 'ǘ': 'ü2', 'ǚ': 'ü3', 'ǜ': 'ü4'
  };

  let tone = '5'; // 默认轻声

  // 替换带声调的字符并提取声调
  for (const [toneChar, replacement] of Object.entries(toneMap)) {
    if (pinyin.includes(toneChar)) {
      tone = replacement.slice(-1);
      result = result.replace(new RegExp(toneChar, 'g'), replacement[0]);
    }
  }

  // 如果找到了声调，则添加数字
  if (tone !== '5' || !Object.values(toneMap).some(val => pinyin.includes(val[0]))) {
    result += tone;
  }

  return result;
}

/**
 * 获取汉字的声母
 * @param {string} char - 汉字
 * @returns {string} 声母
 */
function getInitial(char) {
  if (!pinyinDict[char]) return '';

  const pinyin = pinyinDictWithoutTone[char];
  for (const initial of Object.keys(initialDict).sort((a, b) => b.length - a.length)) {
    if (pinyin.startsWith(initial)) {
      return initial;
    }
  }
  return '';
}

/**
 * 获取汉字的韵母
 * @param {string} char - 汉字
 * @returns {string} 韵母
 */
function getFinal(char) {
  if (!pinyinDict[char]) return '';

  const pinyin = pinyinDictWithoutTone[char];
  const initial = getInitial(char);
  return pinyin.slice(initial.length);
}

// 导出字典和工具函数
module.exports = {
  pinyinDict,                // 带声调的拼音字典
  pinyinDictWithoutTone,     // 不带声调的拼音字典
  pinyinDictWithNumTone,     // 数字声调的拼音字典
  initialDict,               // 声母字典
  convertToneMarkToNumber,   // 声调符号转数字函数
  getInitial,                // 获取声母函数
  getFinal                   // 获取韵母函数
}; 